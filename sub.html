<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- slick css CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <!-- slick css CDN (테마) -->
    <link
      rel="stylesheet"
      type="text/css"
      href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"
    />
    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- slick js CDN -->
    <link
      rel="stylesheet"
      type="text/css"
      href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"
    />
    <!-- CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- sub css -->
    <link rel="stylesheet" href="/sub.css" />
    <!-- slick slider -->
    <script
      type="text/javascript"
      src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"
    ></script>
    <!-- Moment.js CDN - 달력 -->
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

    <!-- Date Range Picker CSS CDN - 달력-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"
    />

    <!-- sub.js -->
    <script type="module" src="sub.js"></script>

    <title>EchoTrip</title>

    <script>
      $(function () {});
    </script>
  </head>

  <body>
    <video autoplay muted loop>
      <source src="./videos/background-video.mp4" />
    </video>

    <!-- 헤더 -->
    <div class="header-section">
      <div class="header-content">
        <span>ECH</span
        ><span><img src="./images/echotrip-logo.png" alt="logo" /></span
        ><span>TRIP</span>
      </div>
    </div>

    <div class="wrapper">
      <!-- 페이지 내용 컨테이너 -->
      <div class="container-fluid">
        <!-- 숙소 정보 -->
        <div class="content">
          <!-- 숙소명-->
          <div class="gh-title">
            <p id="gh-title"></p>
          </div>

          <!-- 숙소 이미지 영역 -->
          <div class="img-container">
            <!-- 왼쪽 영역 (큰그림) -->
            <div class="img-el img-left-section"></div>

            <!-- 중간 영역 (작은 이미지 2개) -->
            <div class="img-middle-section">
              <div class="img-el small-img sm-img-1"></div>
              <div class="img-el small-img sm-img-2"></div>
            </div>

            <!-- 오른쪽 영역 (작은 이미지 2개) -->
            <div class="img img-right-section">
              <div class="img-el small-img sm-img-3"></div>
              <div class="img-el small-img sm-img-4"></div>
            </div>
          </div>

          <!-- 숙소 상세정보 영역 -->
          <div class="gh-details">
            <!-- 왼쪽 영역 -->
            <div class="gh-details-left">
              <!-- 숙소 위치, 별점, 평가 문구 -->
              <div class="overview">
                <div class="overview-left">
                  <p class="gh-location">라스베이거스, 네바다, 미국</p>
                  <p class="gh-rating">★ <span id="gh-rating"></span></p>
                  <!-- 판매자 소개 -->
                  <div class="host-info">
                    <div
                      class="host-img"
                      style="
                        background-image: url('https://a0.muscache.com/im/pictures/user/User-571407812/original/d3298ae6-1ea8-494c-a001-d00e59ed0935.jpeg?im_w=240');
                      "
                    ></div>
                    <div class="host-description">
                      <div class="host-name"></div>
                      <div class="host-intro"></div>
                    </div>
                  </div>
                  <div class="hr"></div>

                  <!-- TODO -->
                  <!-- 편의시설 -->
                  <p class="sub-title">[편의시설]</p>
                  <div class="amenities">
                    <!-- 🍔 조식을 제공해요! &nbsp;&nbsp; 🐶 동물 친구 입장이
                    가능해요! &nbsp;&nbsp; 🚗 주차가능 -->
                  </div>
                  <div class="hr"></div>

                  <!-- 숙소 상세 설명  -->
                  <div class="gh-description">
                    <p id="description"></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 오른쪽 영역 -->
            <div class="gh-details-right">
              <!-- 가격 정보 표시, 매진일 경우 매진으로 표시 -->
              <div class="reserv-container">
                <!-- 구매 가능한 경우 보임 -->
                <div class="available">
                  <div class="price-title">
                    <span>₩ <span id="day-price"></span></span>
                    <span style="font-size: 16px">&nbsp;/&nbsp;박</span>
                  </div>
                  <!-- 날짜선택 , 인원수 선택 -->
                  <div class="select-section">
                    <p style="font-size: 18px">날짜 선택</p>
                    <input
                      type="text"
                      name="daterange"
                      id="daterange"
                      placeholder="날짜를 선택하세요"
                      style="border: 1px solid gray"
                    />

                    <p style="font-size: 18px">인원 수 입력</p>
                    <input
                      type="number"
                      id="guestNum"
                      name="guestNum"
                      placeholder="0"
                    />
                  </div>
                  <!-- 예약하기 버튼 -->
                  <div class="reserv-button">예약하기</div>
                  <p
                    style="
                      text-align: center;
                      margin-top: 20px;
                      font-size: 16px;
                    "
                  >
                    예약 확정 전에는 요금이 청구되지 않습니다.
                  </p>
                  <div class="fee-info">
                    <p>에코트립 서비스 수수료</p>
                    <p><span id="charge"></span></p>
                  </div>

                  <div class="hr"></div>
                  <div
                    class="total-price"
                    style="
                      display: flex;
                      justify-content: space-between;
                      font-size: 26px;
                    "
                  >
                    <p>총 합계</p>
                    <p id="total-price"></p>
                  </div>
                </div>

                <!-- 매진된 경우 표시 -->
                <div class="sold-out">
                  <div class="sold-out-title">
                    해당 숙소는 예약 마감 되었습니다
                  </div>
                  <div class="sold-out-button">예약 가능 시 알림받기</div>
                </div>
              </div>
            </div>

            <!-- 숙소 리뷰 모달창 -->
            <div class="modalBackground">
              <div class="modalContainer">
                <div class="closeButton" onclick="close()">X</div>
                <div class="modalContent">
                  <ul class="all-review-ul">
                    <!-- 리뷰 모달창 -->
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- 차트 -->
          <section class="chart-section">
            <div class="chart-left">
              <span>나라별 예약율</span>
              <div class="chart-bar">
                <canvas id="chart-bar-view"></canvas>
              </div>
            </div>

            <div class="chart-right">
              <span>남녀 숙소 선호도</span>
              <div class="chart-pie">
                <canvas id="chart-pie-view"></canvas>
              </div>
            </div>
          </section>

          <!-- 리뷰 -->
          <section class="review-section">
            <h3>리뷰</h3>
            <div class="hr"></div>
            <ul class="review-ul">
              <!-- 리뷰작성자 프로필 사진, 이름, 별점, 리뷰 내용 -->
            </ul>
            <div class="more-button">후기 14개 모두 보기</div>
          </section>

          <!-- 지도 (iframe) -->
          <section class="gh-map-section">
            <h2 class="gh-map-title">위치</h2>
            <p class="location-name"></p>
            <div class="map">
              <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d412505.9198529579!2d-115.50395679329398!3d36.1251050251558!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x80beb782a4f57dd1%3A0x3accd5e6d5b379a3!2z66-46rWtIOuEpOuwlOuLpCDrnbzsiqTrsqDsnbTqsbDsiqQ!5e0!3m2!1sko!2skr!4v1724321746938!5m2!1sko!2skr"
                width="100%"
                height="100%"
                style="border: 0"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
                id="map-iframe"
              ></iframe>
            </div>
            <!-- TODO -->
            <p class="location-info-title">지역정보</p>
            <p class="location-info"></p>
          </section>
        </div>

        <a href="#" class="btn_gotop">
          <span class="glyphicon glyphicon-chevron-up">TOP</span>
        </a>
      </div>

      <!-- Footer -->
      <footer>
        <div class="container">
          <!-- 상단 섹션: 정보 및 링크 -->
          <div class="row">
            <!-- 회사 정보 -->
            <div class="col-md-3">
              <h5>About Us</h5>
              <p>
                We offer the best selection of guesthouses from around the
                world, connecting travelers with unique and affordable
                accommodation options.
              </p>
            </div>

            <!-- 빠른 링크 -->
            <div class="col-md-3">
              <h5>Quick Links</h5>
              <ul class="list-unstyled">
                <li><a href="#">Home</a></li>
                <li><a href="#">Destinations</a></li>
                <li><a href="#">Guesthouses</a></li>
                <li><a href="#">Blog</a></li>
                <li><a href="#">Contact Us</a></li>
              </ul>
            </div>

            <!-- 고객 지원 -->
            <div class="col-md-3">
              <h5>Customer Support</h5>
              <ul class="list-unstyled">
                <li><a href="#">FAQ</a></li>
                <li><a href="#">Help Center</a></li>
                <li><a href="#">Cancellation Policy</a></li>
                <li><a href="#">Privacy Policy</a></li>
                <li><a href="#">Terms & Conditions</a></li>
              </ul>
            </div>

            <!-- 소셜 미디어 -->
            <div class="col-md-3">
              <h5>Follow Us</h5>
              <ul class="list-unstyled d-flex">
                <li>
                  <a href="#" class="mr-2"
                    ><img
                      src="https://img.icons8.com/fluent/24/000000/facebook-new.png"
                      alt="Facebook"
                  /></a>
                </li>
                <li>
                  <a href="#" class="mr-2"
                    ><img
                      src="https://img.icons8.com/fluent/24/000000/instagram-new.png"
                      alt="Instagram"
                  /></a>
                </li>
                <li>
                  <a href="#" class="mr-2"
                    ><img
                      src="https://img.icons8.com/fluent/24/000000/twitter.png"
                      alt="Twitter"
                  /></a>
                </li>
                <li>
                  <a href="#"
                    ><img
                      src="https://img.icons8.com/fluent/24/000000/youtube-play.png"
                      alt="YouTube"
                  /></a>
                </li>
              </ul>
            </div>
          </div>

          <!-- 하단 섹션: 저작권 및 기타 정보 -->
          <div class="row mt-4">
            <div class="col text-center">
              <p>&copy; 2024 Guesthouse Explorer. All rights reserved.</p>
              <p>
                <a href="#">Terms of Use</a> | <a href="#">Privacy Policy</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Date Range Picker JavaScript CDN -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <!-- 플러그인 추가 (이전에 script 태그로 chartjs-plugin-datalabels를 포함해야 함) -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script type="text/javascript">
      // 로컬스토리지 데이터
      const jsonString = localStorage.getItem("houseInfo");
      // JSON 파싱하여 객체 배열로 변환
      const dataList = JSON.parse(jsonString);
      $(function () {
        /* TOP 버튼 이벤트 처리 */
        $(window).scroll(function () {
          if ($(this).scrollTop() > 300) {
            $(".btn_gotop").show();
          } else {
            $(".btn_gotop").hide();
          }
        });
        $(".btn_gotop").click(function () {
          $("html, body").animate({ scrollTop: 0 }, 400);
          return false;
        });

        let priceToNum = Number(dataList.price.replace(/,/g, ""));
        ////// 상세페이지 정보 //////
        // 숙소 이미지
        $.each(dataList.imageUrl, (index, value) => {
          // 큰 그림
          $(`.img-left-section`).css("background-image", `url(${value})`);
          // 작은 그림
          $(`.sm-img-${index + 1}`).css("background-image", `url(${value})`);
          $(`#modal-img-${index + 1}`).css("background-image", `url(${value})`);
        });

        // 숙소 타이틀
        $("#gh-title").html(dataList.name);
        // 평점
        $("#gh-rating").html(dataList.rate);

        // 판매자 이름
        $(".host-name").html(dataList.sellerName + " 님");
        // 판매자 설명
        $(".host-intro").html(dataList.sellerDescription);

        // 숙소 편의시설
        $.each(dataList.amenities, (index, item) => {
          // if (item == "상위 10% 숙소")
          let logoSrc;
          if (item == "상위 10% 숙소") logoSrc = "trophy";
          if (item == "슈퍼호스트") logoSrc = "medal";
          if (item == "훌륭한 숙소 위치") logoSrc = "location";
          if (item == "공동 주택의 방") logoSrc = "house";
          if (item == "여행 가방 보관 가능") logoSrc = "bag";
          if (item == "와이파이") logoSrc = "wifi";

          $(".amenities").append(
            `<p class="amenities-el">
                <img
                  width="20"
                  height="20"
                  src="/images/${logoSrc}.png"
                  alt="medal"
                />${item}</p>`
          );
        });

        // 숙소 설명
        $("#description").html(dataList.description);

        // 예약, 매진 유무 표시
        if (dataList.price == "0") {
          $(".available").css("display", "none");
          $(".sold-out").css("display", "block");
        } else {
          $(".available").css("display", "black");
          $(".sold-out").css("display", "none");
        }

        // 숙소 가격(1박)
        $("#day-price").html(dataList.price);
        $("#charge").html(
          "₩ " + (priceToNum - priceToNum * 0.9).toLocaleString()
        ); // 서비스 수수료
        $("#total-price").html(
          "₩" + (priceToNum + priceToNum * 0.1).toLocaleString()
        ); // 총 합계 가격

        // 지도 정보
        let location = dataList.location[0];
        $(".location-name").html(location); // 주소명
        $("#map-iframe").attr("src", dataList.location[1]); // 주소 url
        $(".location-info").html(dataList.location[2]); // 지역정보

        // 리뷰 모달창
        $(".more-button").on("click", function () {
          $(".modalBackground").css("display", "block");
          $("body").addClass("no-scroll");
        });
        // 모달창 닫기버튼
        $(".closeButton").on("click", function () {
          console.log("모달 닫기 클릭");
          $(".modalBackground").css("display", "none");
          $("body").removeClass("no-scroll");
        });

        let startDate, endDate;
        $("#daterange").daterangepicker(
          {
            opens: "left",
            locale: {
              format: "YYYY-MM-DD",
            },
          },
          function (start, end, label) {
            console.log(
              "A new date selection was made: " +
                start.format("YYYY-MM-DD") +
                " to " +
                end.format("YYYY-MM-DD")
            );
            startDate = start.format("YYYY-MM-DD");
            endDate = end.format("YYYY-MM-DD");
          }
        );
        // 예약하기 완료 알림창
        $(".reserv-button").on("click", () => {
          let guestNum = $(`#guestNum`).val();
          if (startDate == undefined) {
            return alert("날짜를 선택해주세요.");
          }
          if (guestNum == 0 || guestNum == "") {
            return alert("인원수를 입력해주세요.");
          }
          console.log(`${startDate} ~ ${endDate}`);
          alert(
            `숙박기간 : ${startDate} ~ ${endDate}\n인원수 : ${guestNum}\n예약이 완료되었습니다.`
          );

          // input 초기화
          $("#daterange").val("");
          // Date Range Picker 초기화
          $("#daterange").data("daterangepicker").setStartDate(moment());
          $("#daterange").data("daterangepicker").setEndDate(moment());
          // 인원수 초기화
          $("#guestNum").val("");
        });
      });

      // 1. 막대차트 : 숙소 재방문율
      const ctx = document.querySelector("#chart-bar-view");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["대한민국", "미국", "중국", "프랑스", "영국"],
          datasets: [
            {
              // label: "",
              data: [120, 300, 270, 80, 170],
              // 각 나라별 막대의 색상 지정
              backgroundColor: "#4a90e2", // 동일한 색상으로 설정
              borderColor: "#4a90e2", // 동일한 색상
              // 막대의 굵기 조정
              barThickness: 50, // 막대 굵기 직접 지정
            },
          ],
        },
        options: {
          maintainAspectRatio: false, // 비율이 아닌 부모의 크기에 맞춰 크기 조정
          plugins: {
            legend: {
              display: false, // 라벨 숨기기
            },
          },
          scales: {
            x: {
              ticks: {
                color: "#ffffff",
                font: {
                  size: 16,
                },
              },
            },
            y: {
              ticks: {
                color: "#ffffff",
                font: {
                  size: 16,
                },
              },
            },
          },
        },
      });

      // 2. 파이차트 : 남녀 선호도
      // https://waymond.tistory.com/56
      // 남, 여 선호도 데이터
      const reserveMale = Number(dataList.reserveM);
      const reserveFemale = Number(dataList.reserveW);

      const hoverPieChartCtx = document
        .querySelector("#chart-pie-view")
        .getContext("2d");
      const hoverPieChart = new Chart(hoverPieChartCtx, {
        type: "pie",
        data: {
          labels: ["남성", "여성"],
          datasets: [
            {
              data: [reserveMale, reserveFemale],
              backgroundColor: ["#4a90e2", "#ff6b6b"], // 남성, 여성
              borderColor: ["rgba(0, 0, 255, 0.3)", "rgba(255, 0, 0, 0.3)"],
              borderWidth: 1,
              hoverBackgroundColor: ["#357ABD", "#e35d5d"], // Hover 색상
            },
          ],
        },
        options: {
          plugins: {
            legend: {
              labels: {
                font: {
                  size: 14, // 라벨 글씨 크기
                },
                color: "#fff", // 라벨 글씨 색상
              },
            },
            datalabels: {
              color: "#fff", // 파이 차트 안의 숫자 색상
              font: {
                size: 20, // 파이 차트 안의 숫자 크기
              },
              formatter: (value, context) => {
                const total = context.dataset.data.reduce(
                  (acc, val) => acc + val,
                  0
                );
                const percentage = ((value / total) * 100).toFixed(1);
                return `${percentage}%`; // 백분율로 표시
              },
            },
          },
        },
        plugins: [ChartDataLabels], // 플러그인 등록
      });
    </script>
  </body>
</html>
